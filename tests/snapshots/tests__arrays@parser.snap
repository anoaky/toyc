---
source: tests/tests.rs
expression: ast
snapshot_kind: text
---
[
  FunDefn(
    decl: FunDecl(Void, "test", [
      VarDecl(Int, "s", None),
    ]),
    block: Block(
      stmts: [
        If(
          expr: VarExpr("s"),
          then: ExprStmt(FunCallExpr(VarExpr("print_s"), [
            TypecastExpr(Pointer(Char), Literal(Str("OK"))),
          ])),
          els: Some(ExprStmt(FunCallExpr(VarExpr("print_s"), [
            TypecastExpr(Pointer(Char), Literal(Str("FAIL"))),
          ]))),
        ),
      ],
    ),
  ),
  StructTypeDecl(Struct("pair"), "pair", [
    VarDecl(Int, "x", None),
    VarDecl(Int, "y", None),
  ]),
  StructTypeDecl(Struct("foo"), "foo", [
    VarDecl(Char, "a", None),
    VarDecl(Int, "x", None),
    VarDecl(Char, "b", None),
    VarDecl(Array(3, Char), "c", None),
    VarDecl(Int, "y", None),
  ]),
  FunDefn(
    decl: FunDecl(Void, "skip", [
      VarDecl(Array(3, Int), "a", None),
    ]),
    block: Block(
      stmts: [
        ExprStmt(Assign(ArrayAccessExpr(VarExpr("a"), Literal(Int(2))), BinOp(ArrayAccessExpr(VarExpr("a"), Literal(Int(1))), Mul, Literal(Int(2))))),
      ],
    ),
  ),
  FunDefn(
    decl: FunDecl(Void, "hop", [
      VarDecl(Array(3, Int), "a", None),
    ]),
    block: Block(
      stmts: [
        ExprStmt(Assign(ArrayAccessExpr(VarExpr("a"), Literal(Int(1))), BinOp(ArrayAccessExpr(VarExpr("a"), Literal(Int(0))), Mul, Literal(Int(2))))),
        ExprStmt(FunCallExpr(VarExpr("skip"), [
          VarExpr("a"),
        ])),
      ],
    ),
  ),
  FunDefn(
    decl: FunDecl(Void, "main", []),
    block: Block(
      stmts: [
        ExprStmt(FunCallExpr(VarExpr("print_s"), [
          TypecastExpr(Pointer(Char), Literal(Str("TEST 2D ARRAY "))),
        ])),
        Block(
          stmts: [
            Decl(VarDecl(Int, "i", None)),
            Decl(VarDecl(Int, "j", None)),
            Decl(VarDecl(Array(4, Array(5, Int)), "a", None)),
            ExprStmt(Assign(VarExpr("i"), Literal(Int(0)))),
            While(
              expr: BinOp(VarExpr("i"), Lt, Literal(Int(4))),
              stmt: Block(
                stmts: [
                  ExprStmt(Assign(VarExpr("j"), Literal(Int(0)))),
                  While(
                    expr: BinOp(VarExpr("j"), Lt, Literal(Int(5))),
                    stmt: Block(
                      stmts: [
                        If(
                          expr: BinOp(BinOp(VarExpr("i"), Eq, Literal(Int(0))), And, BinOp(VarExpr("j"), Eq, Literal(Int(2)))),
                          then: ExprStmt(Assign(ArrayAccessExpr(ArrayAccessExpr(VarExpr("a"), VarExpr("i")), VarExpr("j")), Literal(Int(1)))),
                          els: Some(ExprStmt(Assign(ArrayAccessExpr(ArrayAccessExpr(VarExpr("a"), VarExpr("i")), VarExpr("j")), Literal(Int(0))))),
                        ),
                        ExprStmt(Assign(VarExpr("j"), BinOp(VarExpr("j"), Add, Literal(Int(1))))),
                      ],
                    ),
                  ),
                  ExprStmt(Assign(VarExpr("i"), BinOp(VarExpr("i"), Add, Literal(Int(1))))),
                ],
              ),
            ),
            ExprStmt(FunCallExpr(VarExpr("test"), [
              BinOp(ArrayAccessExpr(ArrayAccessExpr(VarExpr("a"), Literal(Int(0))), Literal(Int(2))), Eq, Literal(Int(1))),
            ])),
          ],
        ),
        ExprStmt(FunCallExpr(VarExpr("print_s"), [
          TypecastExpr(Pointer(Char), Literal(Str("nTEST STRUCT ARRAY "))),
        ])),
        Block(
          stmts: [
            Decl(VarDecl(Array(3, Struct("pair")), "p", None)),
            Decl(VarDecl(Int, "i", None)),
            Decl(VarDecl(Int, "success", None)),
            ExprStmt(Assign(VarExpr("i"), Literal(Int(0)))),
            ExprStmt(Assign(VarExpr("success"), Literal(Int(1)))),
            While(
              expr: BinOp(VarExpr("i"), Lt, Literal(Int(3))),
              stmt: Block(
                stmts: [
                  ExprStmt(Assign(FieldAccessExpr(ArrayAccessExpr(VarExpr("p"), VarExpr("i")), "x"), BinOp(Literal(Int(2)), Mul, VarExpr("i")))),
                  ExprStmt(Assign(FieldAccessExpr(ArrayAccessExpr(VarExpr("p"), VarExpr("i")), "y"), BinOp(BinOp(Literal(Int(2)), Mul, VarExpr("i")), Add, Literal(Int(1))))),
                  ExprStmt(Assign(VarExpr("i"), BinOp(VarExpr("i"), Add, Literal(Int(1))))),
                ],
              ),
            ),
            ExprStmt(Assign(VarExpr("i"), Literal(Int(0)))),
            While(
              expr: BinOp(VarExpr("i"), Lt, Literal(Int(3))),
              stmt: Block(
                stmts: [
                  ExprStmt(Assign(VarExpr("success"), BinOp(BinOp(VarExpr("success"), And, BinOp(FieldAccessExpr(ArrayAccessExpr(VarExpr("p"), VarExpr("i")), "x"), Eq, BinOp(Literal(Int(2)), Mul, VarExpr("i")))), And, BinOp(FieldAccessExpr(ArrayAccessExpr(VarExpr("p"), VarExpr("i")), "y"), Eq, BinOp(BinOp(Literal(Int(2)), Mul, VarExpr("i")), Add, Literal(Int(1))))))),
                  ExprStmt(Assign(VarExpr("i"), BinOp(VarExpr("i"), Add, Literal(Int(1))))),
                ],
              ),
            ),
            ExprStmt(FunCallExpr(VarExpr("test"), [
              VarExpr("success"),
            ])),
          ],
        ),
        ExprStmt(FunCallExpr(VarExpr("print_s"), [
          TypecastExpr(Pointer(Char), Literal(Str("nTEST DOUBLE PASS ARRAY "))),
        ])),
        Block(
          stmts: [
            Decl(VarDecl(Array(3, Int), "a", None)),
            ExprStmt(Assign(ArrayAccessExpr(VarExpr("a"), Literal(Int(0))), Literal(Int(1)))),
            ExprStmt(FunCallExpr(VarExpr("hop"), [
              VarExpr("a"),
            ])),
            ExprStmt(FunCallExpr(VarExpr("test"), [
              BinOp(BinOp(BinOp(ArrayAccessExpr(VarExpr("a"), Literal(Int(0))), Eq, Literal(Int(1))), And, BinOp(ArrayAccessExpr(VarExpr("a"), Literal(Int(1))), Eq, Literal(Int(2)))), And, BinOp(ArrayAccessExpr(VarExpr("a"), Literal(Int(2))), Eq, Literal(Int(4)))),
            ])),
          ],
        ),
      ],
    ),
  ),
]
